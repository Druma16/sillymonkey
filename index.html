<!DOCTYPE html>
<html>
<head>
  <title>Item Lookup</title>
  <link rel="stylesheet" href="styles.css">
<!--  <style>-->
<!--    #results-list li[data-id="2"] h3 {-->
<!--      color: red;-->
<!--    }-->
<!--  </style>-->
</head>
<body>
  <header>
    <h1>Item Lookup</h1>
  </header>
<!--  Minimum responsive according to AI -->
  <div class="container">
    <section class="search-section">
      <label for="search-input">Search for an item:</label>
      <input type="text" id="search-input" placeholder="Enter item name">
      <button id="search-button">Search</button>
    </section>

    <section class="results-section">
      <h2>Results:</h2>
      <table id="results-table"></table>
    </section>
  </div>
  <script>

    // Function to handle the lookup
    let itemData = null; // placeholder for caching data

    function lookupItem() {
        const searchInput = document.getElementById('search-input').value.toLowerCase();

        // get the data to use if not cached already
        if (!itemData) {
            // fetch('data.json')
            fetch('https://druma16.github.io/sillymonkey/data.json')
                .then(response => response.json())
                .then(data => {
                    itemData = data; // Cache the data
                    processSearch(searchInput);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        } else {
            processSearch(searchInput);
        }
    } // end lookupItem

    function processSearch(searchInput) {
        // Find the matches TODO is lower case needed on the search input?
        const matchingItems = itemData.filter(item => item.ingredients.toLowerCase().includes(searchInput));

        // Create table header
        const resultsTable = document.getElementById('results-table');
        resultsTable.innerHTML = ''; // clear previous results
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        ['Ingredients','Compatibility', 'Histamine', 'Liberator', 'Amines', 'Blocker', 'Remarks', 'Categories'].forEach(text => {
          const th = document.createElement('th');
          th.textContent = text;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        resultsTable.appendChild(thead);
        const tbody = document.createElement('tbody');

        // Convert matches to display elements (table rows)
        // Add table rows for each item
        if (matchingItems.length > 0) {
          matchingItems.forEach(item => {
              const row = document.createElement('tr');

              const ingredients = document.createElement('td');
              ingredients.textContent = item.ingredients;
              // TODO set attribute value for color coded styling!
              ingredients.setAttribute('data-compat', item.compatibility);
              ingredients.setAttribute('data-label', 'Ingredients:');
              row.appendChild(ingredients);

              const compatibility = document.createElement('td');
              compatibility.textContent = item.compatibility;
              compatibility.setAttribute('data-compat', item.compatibility);
              row.appendChild(compatibility);

              const histamine = document.createElement('td');
              histamine.textContent = item.histamine;
              histamine.setAttribute('data-histamine', item.histamine_num);
              row.appendChild(histamine);

              const liberator = document.createElement('td');
              liberator.textContent = item.liberator;
              liberator.setAttribute('data-liberator', item.liberator_num);
              row.appendChild(liberator)

              const amines = document.createElement('td');
              amines.textContent = item.amines;
              amines.setAttribute('data-amines', item.amines_num);
              row.appendChild(amines);

              const blocker = document.createElement('td');
              blocker.textContent = item.blocker;
              blocker.setAttribute('data-blocker', item.blocker_num);
              row.appendChild(blocker);

              const remarks = document.createElement('td');
              remarks.textContent = item.remarks;
              row.appendChild(remarks);

              const categories = document.createElement('td');
              categories.textContent = item.categories.join(', ');
              row.appendChild(categories);
              tbody.appendChild(row);
            }); // end processing loop
        } else {
          const noResultRow = document.createElement('tr');
          const noResultCell = document.createElement('td');
          noResultCell.setAttribute('colspan', '8');
          noResultCell.textContent = 'No items found.';
          noResultRow.appendChild(noResultCell);
          tbody.appendChild(noResultRow);
        }
        resultsTable.appendChild(tbody);
    } // end processSearch

    // Add event listener to the search button
    document.getElementById('search-button').addEventListener('click', lookupItem);
  </script>
</body>
</html>